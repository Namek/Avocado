<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Title of the document</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <style>
    * {
        font-family: Courier New, Courier, monospace;
    }

    </style>
</head>

<body>
    <div id="status"></div>
    <div id="cpu">
        CPU
        <p id="pc"></p>
        <p id="hi"></p>
        <p id="lo"></p>

        <p>Registers</p>
        <ul id="reg">
        </ul>
    </div>

<script language="javascript" type="text/javascript">
    var ws;
    function connect() {
        ws = new WebSocket("ws://liquid.noip.me:3000");
        var interval = 0;

        $("#status").html("Status: Connecting...");
        
        ws.onopen = function(evt) { 
            $("#status").html("Status: Connected <a href=\"#\" id=\"disconnect\">disconnect</a>");
            $("#disconnect").on("click", function() {
                disconnect();
            });
            interval = setInterval(function() {
                ws.send(".");
            }, 16);
        };
        ws.onclose = function(evt) {
            $("#status").html("Status: Disconnected <a href=\"#\" id=\"reconnect\">reconnect</a>");
            $("#reconnect").on("click", function() {
                connect();
            });
            clearInterval(interval);
        };
        ws.onmessage = function(evt) { 
            var j = JSON.parse(evt.data);
            $("#pc").text("PC: " + j.cpu.pc.toString(16));
            $("#hi").text("hi: " + j.cpu.hi.toString(16));
            $("#lo").text("lo: " + j.cpu.lo.toString(16));
            
            $("#reg").empty();
            for (var i = 0; i < 32; i++) {
                $("#reg").append("<li>r"+i+": "+j.cpu.reg[i].toString(16)+"</li>")
            }
        };
        ws.onerror = function(evt) { 
            $("#status").text("Status: Error ("+evt+")");
            clearInterval(interval);
        };
    }

    function disconnect() {
        ws.close();
    }

    $(function() {
        connect();
    });
  </script>

</body>
</html>